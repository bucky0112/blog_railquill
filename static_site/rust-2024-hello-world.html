<!-- BEGIN app/views/layouts/static.html.erb --><!DOCTYPE html>
<html lang="en">
  <head>
    <title>Rust 從零開始網頁爬蟲(2024 Hello World) - Bucky Chu | Railquill</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    
    <!-- SEO: Allow search engine indexing -->
    <meta name="robots" content="index, follow">
    
      <meta name="description" content="本篇文章是 2024 Hello World Dev Conference 工作坊的實作流程，可以搭配 Github repohttps://github.com/bucky0112/scrapingrust 一起使用。

 Rust 簡介
Rust 是一個近年來引起非常多討論的程式語言，因為效能出色，並且安全性...">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:site_name" content="Bucky Chu | Railquill">
    <meta property="og:url" content="https://railquill.vercel.app/rust-2024-hello-world.html">
      <meta property="og:type" content="article">
      <meta property="og:title" content="Rust 從零開始網頁爬蟲(2024 Hello World)">
      <meta property="og:description" content="本篇文章是 2024 Hello World Dev Conference 工作坊的實作流程，可以搭配 Github repohttps://github.com/bucky0112/scrapingrust 一起使用。

 Rust 簡介
Rust 是一個近年來引起非常多討論的程式語言，因為效能出色，並且安全性...">
      <meta property="og:image" content="/og-image.png">
      
      <!-- Twitter -->
      <meta property="twitter:card" content="summary_large_image">
      <meta property="twitter:title" content="Rust 從零開始網頁爬蟲(2024 Hello World)">
      <meta property="twitter:description" content="本篇文章是 2024 Hello World Dev Conference 工作坊的實作流程，可以搭配 Github repohttps://github.com/bucky0112/scrapingrust 一起使用。

 Rust 簡介
Rust 是一個近年來引起非常多討論的程式語言，因為效能出色，並且安全性...">
      <meta property="twitter:image" content="/og-image.png">
      
      <!-- Article specific meta tags -->
      <meta property="article:published_time" content="2024-09-13T00:43:33Z">
      <meta property="article:modified_time" content="2025-09-19T17:23:22Z">
      <meta property="article:author" content="Bucky Chu">
      <meta name="author" content="Bucky Chu">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
      {"@context":"https://schema.org","@graph":[{"@type":"WebSite","name":"Bucky Chu | Railquill","url":null,"description":"From web applications to mobile apps and indie games, I love building across different platforms.  \r\nThis blog, built on **Railquill**, is my space to share insights, experiments, and the craft of writing clean, maintainable, and impactful software.\r\n","publisher":{"@type":"Organization","name":"Bucky Chu | Railquill","url":null,"logo":{"@type":"ImageObject","url":"/favicon.ico"},"contactPoint":{"@type":"ContactPoint","email":"bucky0112@gmail.com","contactType":"customer support"},"sameAs":["https://github.com/bucky0112/railquill","https://x.com/bucky0112"]}},{"@type":"Article","headline":"Rust 從零開始網頁爬蟲(2024 Hello World)","description":"本篇文章是 2024 Hello World Dev Conference 工作坊的實作流程，可以搭配 Github repohttps://github.com/bucky0112/scrapingrust 一起使用。\n\n Rust 簡介\nRust 是一個近年來引起非常多討論的程式語言，因為效能出色，並且安全性...","url":"https://railquill.vercel.app/rust-2024-hello-world.html","datePublished":"2024-09-13T00:43:33Z","dateModified":"2025-09-19T17:23:22Z","author":{"@type":"Person","name":"Bucky Chu","url":"https://github.com/bucky0112"},"publisher":{"@type":"Organization","name":"Bucky Chu | Railquill","url":null,"logo":{"@type":"ImageObject","url":"/favicon.ico"},"contactPoint":{"@type":"ContactPoint","email":"bucky0112@gmail.com","contactType":"customer support"},"sameAs":["https://github.com/bucky0112/railquill","https://x.com/bucky0112"]},"mainEntityOfPage":{"@type":"WebPage","@id":"https://railquill.vercel.app/rust-2024-hello-world.html"},"articleBody":"本篇文章是 2024 Hello World Dev Conference 工作坊的實作流程，可以搭配 Github repo 一起使用。\n\nRust 簡介\n\nRust 是一個近年來引起非常多討論的程式語言，因為效能出色，並且安全性極佳，寫起來非常有趣，在每一年的 Stackoverflow 調查中已經連續蟬聯多年的最受歡迎程式語言（most-admired programming language），可以參考今年 2024 的調查。也因為討論度很高，並且很多國際知名企業也紛紛投入使用，可以感受到似乎引領了一股風潮，好像什麼都要用 Rust 來改寫原本的產品，或者是出現以 Rust 開發的新東西。\n\n安裝 Rust\n\n要安裝 Rust 非常簡單，只要進到官網，然後按下“立即開始”的按鈕，就會偵測你目前電腦的系統，並給你安裝的建議與說明。像是我的電腦是 macOS 系統，所以只要按照指示，在終端機執行指令，就可以開始安裝。\n\n安裝 Rust 這個步驟主要會安裝兩個東西，分別是：\n\n\nRustup\nCargo\n\n\nRustup 是 Rust 的安裝與版本管理工具，而 Cargo 則是 Rust 的建置與套件管理工具。\n\n如果想確認是否安裝成功，可以在終端機下指令：\n\nrustc -V\n\n\n或者是：\n\ncargo -V\n\n\n這兩個都能檢查目前安裝的版本（截至目前為止的版本為 1.81.0），例如下圖：\n\n\n\nHello World，建立專案\n\n既然安裝好了，不免俗的讓我們來做一個 Hello World，這裡會直接使用 Cargo 來建立一個 Rust 專案，請在終端機執行：\n\ncargo new demo\n\n\n這段指令代表要使用 Cargo 來建立一個名稱 demo 的專案，當然名稱可以自由命名。然後進入到該專案之後，並使用習慣的編輯器打開，例如 VSCode。\n\n建議 VSCode 套件\n\n如果是習慣用 VSCode 的人，強烈建議 rust-analyzer 這個套件。在開發中可以有一些提示，或者是錯誤的提醒。\n\n現在你應該使用編輯器打開專案了，並且可以看到專案的架構：\n\n.\n├── src\n│   └── main.rs\n├── target\n├── .gitignore\n├── Cargo.lock\n└── Cargo.toml\n\n\n整個專案最主要的檔案是在 src 底下的 main.rs，它是 Rust 專案的 entrypoint，任何邏輯都會經由這裡來發動執行，那麼我們來看看 main.rs 這個檔案。\n\nfn main() {\n    println!(\"Hello, world!\");\n}\n\n\n可以看到建立專案已經幫我們處理好 Hello World 了，但是這個 println!() 是什麼？\n\n以目的來說，他可以幫我們印出 Hello World，雖然看起來很像是一個函式，但在 Rust 中其實不是函式，而是一個巨集（Marco），可以先大概了解就可以。\n\n執行專案\n\n在 Cargo 專案中，要執行並且運作程式碼，可以在終端機下指令：\n\ncargo run\n\n\n這一段指令會編譯並且執行目前的程式碼，所以可以在終端機看到 Hello World 的結果。\n\n開始爬蟲\n\n在開始之前，需要先安裝這個專案需要用的套件。\n\n套件的搜尋\n\n如果是熟悉網頁開發的朋友，大概都會知道有 NPM 這個東西，而 Rust 也有一個類似 NPM 的網站，那就是 crates.io\n\n\n\n我們需要安裝這些套件：\n\n\ntokio\nreqwest\nscraper\n\n\ntokio 主要是處理非同步的操作；reqwest 是處理 HTTP 請求；scraper 則是處理網頁元素的選擇。\n\n套件安裝的方式\n\n套件安裝的方式有分成在終端機下指令安裝，和在專案中的 Cargo.toml 手動輸入。以 tokio 為例，可以在右邊的 Install 區塊看到安裝方式。\n\n\n\n第一種方式是在終端機下指令：\n\ncargo add tokio\n\n\n第二種方式可以打開 Cargo.toml 這個檔案，然後在 [dependencies] 底下輸入：\n\ntokio = \"1.40.0\"\n\n\n安裝 tokio 需要注意的地方\n\n由於 crates 大都預設是基本的安裝，所以當需要開啟某些功能，還需要開啟設定，安裝的方式可以這樣做：\n\n第一種在終端機下指令：\n\ncargo add tokio -F full\n\n\n第二種方式也可以透過 Cargo.toml 來安裝：\n\ntokio = { version = \"1.40.0\", features = [\"full\"] }\n\n\n如果是經由 Cargo.toml 來安裝的話，還需要在終端機下指令來進行編譯：\n\ncargo build\n\n\n目前的 Cargo.toml 應該會是這樣：\n\n\n\n要進行爬蟲的資料來源\n\n這次工作坊要進行的爬蟲練習來源是這個網站。這是一個專門練習爬蟲的網站。\n\n\n\n試著取得網頁內容\n\n接下來就可以寫一些程式碼，先試著連到這個網站並取得網頁內容：\n\nuse reqwest;       // 使用 reqwest\n\n#[tokio::main]     // 在 main 標記使用 tokio 處理非同步\nasync fn main() {  // 在 main 前面加上 async\n    let url = \"https://books.toscrape.com/\"; // 連結的 URL\n    let response = reqwest::get(url).await.unwrap(); // 使用 get\n    let body = response.text().await.unwrap(); // 將 response 轉成可辨識的文字\n\n    println!(\"{}\", body); // 印出 body\n}\n\n\n然後執行 cargo run，應該會看到印出整個網頁的內容。\n\n解析 HTML\n\n確認網頁內容沒問題之後，就可以進行下一步來解析 HTML，這裡需要借助 scraper。\n\nuse scraper::Html; // 使用 scraper 的 HTML 方法\n\n// ...\n\nlet document = Html::parse_document(\u0026amp;body); // 解析 body\n\nprintln!(\"{}\", document);\n\n\n這時候執行 cargo run 之後，會發現到有錯誤。\n\n\n\nCargo 會提供完整的錯誤提示，甚至會跟你說你應該怎麼做比較好，所以就可以按照它的建議在 println!() 中的 {} 改成 {:?} 或者是 {:#?}。\n\n可以改成以下幾種方式：\n\nprintln!(\"{:?}\", document); // debug 格式化\n\nprintln!(\"{:#?}\", document); // pretty-print 格式\n\nprintln!(\"{}\", document.html()); // 轉回字符串，就是轉回原來的格式\n\n\n決定抓取哪些資料\n\n我們主要是要抓每本書的名稱以及價錢，打開開發者工具檢查 HTML 架構，可以發現這裡是用 \u0026lt;li\u0026gt; 來區分每本書，但我們需要更方便辨識的方法，也就是按照 \u0026lt;li\u0026gt; 中的 \u0026lt;article\u0026gt;，這裡有 class 可以辨識，也就是 product_pod，這樣就可以去選取每一本獨立的書。\n\n當選擇完每本書之後，就要去抓取書的書名以及價錢，可以在 \u0026lt;h3\u0026gt; 和 .product_price。\n\n\n\n建立選取器\n\nuse scraper::{Html, Selector};\n// ...\nlet book_selector = Selector::parse(\"article.product_pod\").unwrap();\nlet title_selector = Selector::parse(\"h3 a\").unwrap();\nlet price_selector = Selector::parse(\"div.product_price .price_color\").unwrap();\n\n\n使用迴圈撈取資料\n\n接下來就可以使用迴圈來撈取資料：\n\nfor book in document.select(\u0026amp;book_selector) {\n    let title = book\n        .select(\u0026amp;title_selector)\n        .next()\n        .unwrap()\n        .text()\n        .collect::\u0026lt;String\u0026gt;();\n    let price = book\n        .select(\u0026amp;price_selector)\n        .next()\n        .unwrap()\n        .text()\n        .collect::\u0026lt;String\u0026gt;();\n\n    println!(\"書名: {}\", title);\n    println!(\"價格: {}\", price);\n    println!(\"---\");\n}\n\n\n執行 cargo run 之後，這樣就可以把每本書的書名以及價格全部印出來。\n\n利用屬性取得完整書名\n\n執行完之後雖然可以取得書名以及價格，但是應該可以發現有些書名並不是完整的書名。\n\n\n\n這是因為網站本身在處理書名時，可能是針對太長的書名有進行修改。沒關係，可以看一下 HTML 架構中是否有提供完整的書名。\n\n\n\n我們發現在 \u0026lt;h3\u0026gt; 中的 \u0026lt;a\u0026gt; 有一個 title 的屬性，所以就可以利用這個屬性去取得完整的書名。\n\nlet title_element = book.select(\u0026amp;title_selector).next().unwrap();\n        // 使用 title 屬性獲取完整書名\nlet title = title_element.value().attr(\"title\").unwrap_or(\"Unknown Title\");\n\n\n現在再次執行 cargo run 就可以取得完整的書名了。\n\n錯誤處理\n\n如果看現在的程式碼，應該可以發現有大量的 unwrap()。其實這個是錯誤處理的方式之一，但是並不能算是非常好的作法，因為當有碰到錯誤的時候，在 unwrap() 這裡就會立即終止所有程式，不會再繼續往下走了，如果是拿來開發初期可能很好用，但是還是要預想遇到錯誤會怎麼繼續往下跑你的程式碼。\n\n這裡就會用到 Rust 本身自帶的工具，從 std 也就是 Rust 的 standard library 中使用 Error：\n\nuse std::error::Error;\n\n\n那麼要怎麼使用呢？\n\n首先會用到 Result 這個 enum，它是一個這樣的結構：\n\npub enum Result\u0026lt;T, E\u0026gt; {\n    Ok( /* … */ ),\n    Err( /* … */ ),\n}\n\n\n原本應該也要使用關鍵字 use 來使用：\n\nuse std::result::Result;\n\n\n不過可能因為 Result 是比較常用，所以就不需要特別使用 use 來引入，而是可以直接用。\n\nasync fn main() -\u0026gt; Result\u0026lt;(), Box\u0026lt;dyn Error\u0026gt;\u0026gt; {\n    // ...\n    Ok(())\n}\n\n\n由於 Result 是一個 enum，只有兩條路，不是正確就是錯誤，所以在 main 這裡設置 Result 也就代表了要回傳東西，我們在最後面擺上一個 Ok(()) 就好。\n\n取代 unwrap()\n\n接下來其他的錯誤就可以把所有的 unwrap() 都拿掉，但是選取 HTML 的部分如果壞掉，好像也不需要繼續往下執行，所以替換成 ? 表示暫不處理。\n\nlet response = reqwest::get(url).await?;\nlet body = response.text().await?;\nlet document = Html::parse_document(\u0026amp;body);\n\nlet book_selector = Selector::parse(\"article.product_pod\")?;\nlet title_selector = Selector::parse(\"h3 a\")?;\nlet price_selector = Selector::parse(\"div.product_price .price_color\")?;\n\n\n可以加上失敗後顯示的文字\n\n而在迴圈的部分如果找不到相對應的元素就再提示並顯示錯誤訊息。\n\nfor book in document.select(\u0026amp;book_selector) {\n    let title_element = book.select(\u0026amp;title_selector).next().ok_or(\"找不到 Title 元素\")?;\n    let title = title_element\n        .value()\n        .attr(\"title\")\n        .ok_or(\"找不到 Title 屬性\")?;\n    let price = book\n        .select(\u0026amp;price_selector)\n        .next()\n        .ok_or(\"找不到 Price 元素\")?\n        .text()\n        .collect::\u0026lt;String\u0026gt;();\n\n        // ...\n}\n\n\n拿取其他頁面的資料\n\n由於最下面有分頁，代表其他頁面也有資料還沒撈取，而目前只有爬第一頁的資料，所以我們接下來試著爬完全部頁面的資料。\n\n我們可以先觀察第一頁跟其他頁的差異在哪。\n\n其實整個 HTML 架構都差不多，最大的差別只在於 URL 而已，例如第一頁是 https://books.toscrape.com/，而第二頁則是 https://books.toscrape.com/catalogue/page-2.html，剩下幾頁的差別都只是在 page 之後的數字差別而已，接下來比較方便的作法則是建立一個 client。\n\n建立 client 並測試是否可以爬到第二頁\n\n這一步驟要先使用 reqwest 建立一個 client，比較方便去 get 不同頁面的 URL。下面的程式碼會用迴圈先試跑個兩圈，看看兩頁是不是都能成功連到，然後印出爬到的頁面跟狀態碼是否正確還有符合我們想要的。\n\nasync fn main() -\u0026gt; Result\u0026lt;(), Box\u0026lt;dyn Error\u0026gt;\u0026gt; {\n    let client = reqwest::Client::builder().build()?;\n\n    for page in 1..=2 {\n        let url = if page == 1 {\n            \"https://books.toscrape.com\".to_string()\n        } else {\n            format!(\"https://books.toscrape.com/catalogue/page-{}.html\", page)\n        };\n\n        println!(\"正在爬取頁面: {}\", url);\n\n        let response = client.get(\u0026amp;url).send().await?;\n        println!(\"狀態: {}\", response.status());\n\n        if !response.status().is_success() {\n            println!(\"狀態碼: {}\", response.status());\n            continue;\n        }\n    }\n\n    Ok(())\n}\n\n\n這裡可以試試看把網頁改成錯誤的會發生什麼事，例如把 URL 故意打錯。\n\n\n\n到這一步應該都能成功讓兩個頁面的狀態都是 200，所以就可以繼續往下進行。\n\n計算每頁抓到的書是否正確\n\n如果檢查每一頁應該可以發現每一頁的書都是固定的 20 本，所以檢查一下用選取器在第二頁是否也正常。\n\nfor page in 1..=2 {\n    // 省略\n    let body = response.text().await?;\n    let document = Html::parse_document(\u0026amp;body);\n    let book_selector = Selector::parse(\"article.product_pod\")?;\n    // 省略\n\n    let mut book_count = 0;\n\n    for _book in document.select(\u0026amp;book_selector) {\n        // 省略\n        book_count += 1;\n    }\n\n    println!(\"在第 {} 頁找到 {} 本書\", page, book_count);\n}\n\n\nbook_count 是一個會一直往上加的值，代表這個值需要一直改變，並且最後會使用這個改變後的變數，所以要使用 mut 這個關鍵字來表示這個變數是可變。\n\n然後 for 迴圈的 book 沒有加上 _ 的話，或者應該說在 Rust 的程式碼如果有定義但沒使用，在終端機應該可以看到一些警告，這不是錯誤，只是 Rust 會很 nice 地（雞婆）提醒您有變數沒使用，所以可以註解掉該變數，或者在變數前面加上 _，表示目前暫時用不到。\n\n當然如果你不介意這些警告，也可以不用理他。\n\n執行 cargo run 之後應該會看到兩頁都能撈到 20 本書，所以就可以試著跑完全部的頁面，只要把迴圈的數字改成最大頁數就好，以這個網站來看，改成 50 之後跑看看，觀察一下每一頁狀態是不是正常，找到的書本是不是正確的數字。\n\n\n\n如果超過頁面會怎麼樣？\n\n我們知道現在總共有 50 頁，但如果想要看看跑超過 50 頁會怎麼樣，我們來試試看，改成 51。\n\n其實就跟前面故意把 URL 改成錯誤一樣，在第一個迴圈就會出現錯誤，然後按照我們設想的錯誤並回傳錯誤訊息，所以使用正確的錯誤處理是非常好的一件事，這裡如果是用 unwrap() 雖然也可能會回傳錯誤訊息，但這種錯誤是我們可以掌握並處理的。\n\n儲存完整資料 -\u0026gt; JSON\n\n其實現在跑下來是可以在終端機顯示全部並且完整的書名以及價錢，但 50 頁的資料量滿多的，而且也不好閱讀，所以讓我們試著把資料存成 JSON。\n\n安裝 crates 來處理 JSON\n\n我們需要兩種 crates 來處理 JSON，這裡推薦：\n\n\nserde\nserde_json\n\n\n安裝 serde 需要開啟完整的功能，所以在安裝可以這樣：\n\ncargo add serde -F derive\n\n\nserde 會按照我們設定的 struct 去解析資料，然後再經由 serde_json 轉出 JSON。\n\n\n\nstruct 是 Rust 中定義型別的一種方式，可以想像成類似 TS 的 interface。\n\n使用 serde 以及 File 並定義 struct\n\n這一步需要使用剛剛安裝的 serde 然後還需要使用 Rust 內建的 File 來轉出檔案，然後還需要定義 JSON 的格式，也就是 struct，然後使用 serde 來標記，最後才能給 serde_json 使用。\n\nuse serde::{Deserialize, Serialize};\nuse std::fs::File;\n\n#[derive(Serialize, Deserialize)]\nstruct Book {\n    title: String,\n    price: String,\n}\n\n\n建立一個 Vec\n\n建立完 JSON 的格式之後，由於 JSON 是由一個陣列包著物件這樣的格式，所以我們還需要建立一個陣列來使用。\n\n不過在 Rust 的世界中，陣列（array）只能是一個固定長度，並且有長度限制，所以除非你確切知道你的資料長度，所以一般動態資料會使用向量 (vector)。\n\nlet client = reqwest::Client::builder().build()?;\nlet mut books = Vec::new();\n\n\n把每本書塞進 JSON\n\n接下來就可以在 book_selector 迴圈中把每本書都塞進 books 這個 vector 當中。\n\n for book in document.select(\u0026amp;book_selector) {\n    book_count += 1;\n    let title_element = book.select(\u0026amp;title_selector).next().unwrap();\n    let title = title_element\n        .value()\n        .attr(\"title\")\n        .ok_or(\"找不到 Title 屬性\")?;\n    let price = book\n        .select(\u0026amp;price_selector)\n        .next()\n        .ok_or(\"找不到 Price 元素\")?\n        .text()\n        .collect::\u0026lt;String\u0026gt;();\n\n    books.push(Book {\n        title: title.to_string(),\n        price,\n    });\n\n    println!(\"書名: {}\", title);\n    // println!(\"價格: {}\", price);\n    println!(\"---\");\n}\n\n\n然後使用 serde_json 和 File 將資料寫成一個 json 檔案。\n\nlet file = File::create(\"books.json\")?;\nserde_json::to_writer_pretty(file, \u0026amp;books)?;\n\nprintln!(\"資料已存到 books.json\");\n\nOk(())\n\n\n然後你可能會覺得有點奇怪，為什麼將 title 跟 price 塞入的時候，price 並沒有像 title 那樣轉成 string。\n\n這是因為 Book 在 struct 中定義成 String，然後 price 最後有轉成 String，而 title 沒有，它的型別原本是 \u0026amp;str（字串切片）。所以你要在 push 的時候轉成 String 或者是這樣也可以：\n\nfor book in document.select(\u0026amp;book_selector) {\n    book_count += 1;\n    let title_element = book.select(\u0026amp;title_selector).next().unwrap();\n    let title = title_element\n        .value()\n        .attr(\"title\")\n        .ok_or(\"找不到 Title 屬性\")?\n        .to_string();\n    let price = book\n        .select(\u0026amp;price_selector)\n        .next()\n        .ok_or(\"找不到 Price 元素\")?\n        .text()\n        .collect::\u0026lt;String\u0026gt;();\n\n    books.push(Book {\n        title,\n        price,\n    });\n}\n\n\n然後你就可以執行 cargo run 並且將資料存成 JSON 了。\n\n如果想存成 Excel 可以嗎？\n\n沒問題！Rust 的 crates 也可以找得到專門處理 excel 的套件，那就是 xlsxwriter。\n\n安裝 xlsxwriter 並使用\n\n按照說明安裝完之後並使用：\n\nuse xlsxwriter::Workbook;\n\n\nlet workbook = Workbook::new(\"books.xlsx\")?;\nlet mut sheet = workbook.add_worksheet(None)?;\n\nsheet.write_string(0, 0, \"書名\", None)?;\nsheet.write_string(0, 1, \"價格\", None)?;\n\nlet mut row = 1;\n\n\n變數 row 會按照資料筆數一直增加欄位，所以需要讓他是一個可變變數。\n然後在迴圈中寫入：\n\nfor book in document.select(\u0026amp;book_selector) {\n    book_count += 1;\n    let title_element = book.select(\u0026amp;title_selector).next().unwrap();\n    let title = title_element\n        .value()\n        .attr(\"title\")\n        .ok_or(\"找不到 Title 屬性\")?;\n    let price = book\n        .select(\u0026amp;price_selector)\n        .next()\n        .ok_or(\"找不到 Price 元素\")?\n        .text()\n        .collect::\u0026lt;String\u0026gt;();\n\n    sheet.write_string(row, 0, title, None)?;\n    sheet.write_string(row, 1, \u0026amp;price, None)?;\n\n    books.push(Book {\n        title: title.to_string(),\n        price,\n    });\n\n    row += 1;\n}\n\n\n你可能發現到 sheet 在寫入價格欄位時，price 寫成了 \u0026amp;price。\n\u0026amp; 是 Rust 中所有權常用的一個借用概念。\n\n如果拿掉的話，這裡 Cargo 會提示你使用 \u0026amp;，不然會出錯。\n\n執行 cargo run 應該就可以將資料存成 excel。\n\n自動取得全部頁面資料\n\n目前已經可以爬完全部頁面的資料，不過如果未來網站資料變多的話，那麼是不是代表會超過 50 頁？\n雖然是可以再手動修改頁數，但我們可以去偵測全部的總頁數，然後就可以自動爬完全部頁數的資料了。\n\n我們可以透過一個自定義的 function 來做這件事。\n\nasync fn get_total_pages(client: \u0026amp;reqwest::Client) -\u0026gt; Result\u0026lt;u32, Box\u0026lt;dyn Error\u0026gt;\u0026gt; {\n    let url = \"https://books.toscrape.com/index.html\";\n    let response = client.get(url).send().await?;\n    let body = response.text().await?;\n    let document = Html::parse_document(\u0026amp;body);\n\n    let pager_selector = Selector::parse(\"ul.pager li.current\")?;\n    let pager_text = document\n        .select(\u0026amp;pager_selector)\n        .next()\n        .ok_or(\"無法找到分頁資料\")?\n        .text()\n        .collect::\u0026lt;String\u0026gt;();\n\n    let total_pages = pager_text\n        .split_whitespace()\n        .last()\n        .ok_or(\"無法取得總頁數\")?\n        .parse::\u0026lt;u32\u0026gt;()?;\n\n    Ok(total_pages)\n}\n\n\n這裡會借用 client 來使用選取器，然後並透過分頁的部分去計算總頁數。\n\n\n\n這裡就可以取代掉原本的數字。\n\n    // 取得總頁數\nlet total_pages = get_total_pages(\u0026amp;client).await?;\nprintln!(\"總頁數: {}\", total_pages);\n\n\n執行後，一樣可以正常寫入，但這樣的函式可以幫助我們動態去計算總頁數，然後取得全部的資料。\n","wordCount":1264,"timeRequired":"PT7M"}]}
    </script>
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://railquill.vercel.app/rust-2024-hello-world.html">
    
    <!-- Favicons -->
    <link rel="icon" href="/favicon.ico" sizes="32x32">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lora:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    
    <style>
      /* Design System CSS Variables */
      :root {
        /* Brand Colors */
        --primary-50: #EEF2FF;
        --primary-100: #E0E7FF;
        --primary-200: #C7D2FE;
        --primary-300: #A5B4FC;
        --primary-400: #818CF8;
        --primary-500: #6366F1;
        --primary-600: #4F46E5;
        --primary-700: #4338CA;
        --primary-800: #3730A3;
        --primary-900: #312E81;

        /* Neutral Colors */
        --gray-50: #F9FAFB;
        --gray-100: #F3F4F6;
        --gray-200: #E5E7EB;
        --gray-300: #D1D5DB;
        --gray-400: #9CA3AF;
        --gray-500: #6B7280;
        --gray-600: #4B5563;
        --gray-700: #374151;
        --gray-800: #1F2937;
        --gray-900: #111827;

        /* Semantic Colors */
        --success: #059669;
        --success-light: #D1FAE5;
        --warning: #D97706;
        --warning-light: #FEF3C7;
        --error: #DC2626;
        --error-light: #FEE2E2;
        --info: #2563EB;
        --info-light: #DBEAFE;
        
        /* Typography */
        --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        --font-serif: 'Lora', Georgia, 'Times New Roman', serif;
        --font-mono: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
        
        /* Type Scale */
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;
        --text-4xl: 2.25rem;
        --text-5xl: 3rem;
        --text-6xl: 3.75rem;
        
        /* Line Heights */
        --leading-none: 1;
        --leading-tight: 1.25;
        --leading-snug: 1.375;
        --leading-normal: 1.5;
        --leading-relaxed: 1.625;
        --leading-loose: 2;
        
        /* Letter Spacing */
        --tracking-tighter: -0.05em;
        --tracking-tight: -0.025em;
        --tracking-normal: 0;
        --tracking-wide: 0.025em;
        --tracking-wider: 0.05em;
        --tracking-widest: 0.1em;
        
        /* Spacing */
        --space-px: 1px;
        --space-0: 0;
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;
        --space-10: 2.5rem;
        --space-12: 3rem;
        --space-16: 4rem;
        --space-20: 5rem;
        --space-24: 6rem;
        
        /* Transitions */
        --ease-linear: linear;
        --ease-in: cubic-bezier(0.4, 0, 1, 1);
        --ease-out: cubic-bezier(0, 0, 0.2, 1);
        --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      /* Reset and base styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: var(--font-sans);
        line-height: 1.6;
        color: var(--gray-900);
        background: #fff;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      /* Container */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1.5rem;
      }
      
      .container-narrow {
        max-width: 680px;
        margin: 0 auto;
        padding: 0 1.5rem;
      }
      
      /* Header */
      header {
        background: #fff;
        border-bottom: 1px solid var(--gray-100);
        padding: 1.5rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.9);
      }
      
      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      header h1 {
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: -0.025em;
      }
      
      header a {
        color: var(--gray-900);
        text-decoration: none;
        transition: color 0.2s;
      }
      
      header a:hover {
        color: var(--primary-600);
      }
      
      header a:focus {
        color: var(--primary-600);
        outline: 2px solid var(--primary-500);
        outline-offset: 2px;
      }
      
      .header-nav {
        display: flex;
        gap: 2rem;
        align-items: center;
      }
      
      .header-nav a {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-700);
      }
      
      /* Main content */
      main {
        min-height: calc(100vh - 200px);
        padding: 3rem 0;
      }
      
      /* Hero Section */
      /* Hero Section */
      .hero {
        text-align: center;
        padding: var(--space-16) 0;
        margin-bottom: var(--space-16);
        background: linear-gradient(135deg, var(--gray-50) 0%, #fff 100%);
        border-radius: 1rem;
        position: relative;
        overflow: hidden;
      }
      
      .hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at 30% 20%, var(--primary-100) 0%, transparent 50%), 
                    radial-gradient(circle at 80% 80%, var(--primary-50) 0%, transparent 50%);
        opacity: 0.5;
        z-index: 1;
      }
      
      .hero > * {
        position: relative;
        z-index: 2;
      }
      
      .hero h2 {
        font-size: var(--text-5xl);
        font-weight: 700;
        letter-spacing: var(--tracking-tight);
        margin-bottom: var(--space-4);
        background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-500) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: var(--leading-tight);
      }
      
      .hero p {
        font-size: var(--text-xl);
        color: var(--gray-600);
        max-width: 600px;
        margin: 0 auto;
        line-height: var(--leading-relaxed);
      }
      
      /* Article styles */
      article {
        margin-bottom: 3rem;
      }
      
      article h1 {
        font-size: 3rem;
        margin-bottom: 1.5rem;
        line-height: 1.1;
        letter-spacing: -0.025em;
        font-weight: 800;
      }
      
      article h2 {
        font-size: 2rem;
        margin: 3rem 0 1.5rem;
        font-weight: 700;
        letter-spacing: -0.025em;
      }
      
      article h3 {
        font-size: 1.5rem;
        margin: 2rem 0 1rem;
        font-weight: 600;
      }
      
      article p {
        margin-bottom: 1.5rem;
        font-family: var(--font-serif);
        font-size: 1.125rem;
        line-height: 1.75;
        color: var(--gray-700);
      }
      
      article a {
        color: var(--primary-600);
        text-decoration: none;
        border-bottom: 1px solid transparent;
        transition: border-color 0.2s;
      }
      
      article a:hover {
        border-bottom-color: var(--primary-600);
      }
      
      article a:focus {
        border-bottom-color: var(--primary-600);
        outline: 2px solid var(--primary-500);
        outline-offset: 2px;
      }
      
      /* Drop cap for article content */
      .post-content > p:first-of-type::first-letter {
        float: left;
        font-size: 4rem;
        line-height: 3.5rem;
        padding-right: var(--space-2);
        margin-top: -0.25rem;
        font-weight: 700;
        color: var(--primary-600);
        font-family: var(--font-serif);
      }
      
      article code {
        background: var(--gray-100);
        padding: 0.125em 0.375em;
        border-radius: 0.25rem;
        font-family: var(--font-mono);
        font-size: 0.875em;
        color: var(--gray-900);
      }
      
      article pre {
        background: var(--gray-900);
        color: var(--gray-100);
        padding: 1.5rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 2rem 0;
        position: relative;
      }
      
      article pre code {
        background: none;
        padding: 0;
        color: inherit;
        font-size: 0.875rem;
        line-height: 1.7;
      }
      
      /* Enhanced syntax highlighting for common languages */
      .highlight .c { color: #6B7280; font-style: italic; } /* Comment */
      .highlight .k { color: #7C3AED; font-weight: bold; } /* Keyword */
      .highlight .s { color: #059669; } /* String */
      .highlight .mi { color: #DC2626; } /* Number */
      .highlight .nf { color: #2563EB; } /* Function */
      .highlight .nc { color: #7C2D12; font-weight: bold; } /* Class */
      .highlight .na { color: #B45309; } /* Attribute */
      .highlight .nb { color: #7C3AED; } /* Built-in */
      .highlight .err { color: #DC2626; background: var(--error-light); } /* Error */
      
      article blockquote {
        border-left: 4px solid var(--primary-600);
        padding-left: 1.5rem;
        margin: 2rem 0;
        font-style: italic;
        color: var(--gray-700);
      }
      
      article blockquote p {
        font-size: 1.25rem;
      }
      
      article ul, article ol {
        margin-bottom: 1.5rem;
        padding-left: 2rem;
        font-family: var(--font-serif);
      }
      
      article li {
        margin-bottom: 0.5rem;
        font-size: 1.125rem;
        line-height: 1.75;
        color: var(--gray-700);
      }
      
      article table {
        width: 100%;
        border-collapse: collapse;
        margin: 2rem 0;
        font-size: 0.875rem;
      }
      
      article th, article td {
        padding: 0.75rem;
        border-bottom: 1px solid var(--gray-200);
        text-align: left;
      }
      
      article th {
        background: var(--gray-50);
        font-weight: 600;
        color: var(--gray-900);
        font-family: var(--font-sans);
      }
      
      article tbody tr:hover {
        background: var(--gray-50);
      }
      
      /* Article images - responsive sizing */
      article img {
        max-width: 100%;
        height: auto;
        margin: 2rem 0;
        border-radius: 0.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      
      article img:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      }
      
      /* Center images in paragraphs */
      article p img {
        display: block;
        margin: 2rem auto;
      }
      
      /* Article iframes - responsive embedded content */
      article iframe {
        max-width: 100%;
        width: 100%;
        height: 400px;
        min-height: 300px;
        margin: 2rem 0;
        border-radius: 0.5rem;
        border: 1px solid var(--gray-200);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.3s ease;
      }
      
      article iframe:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      }
      
      /* Responsive iframe heights for different screen sizes */
      @media (min-width: 768px) {
        article iframe {
          height: 500px;
        }
      }
      
      /* Post meta */
      .post-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        color: var(--gray-500);
        margin-bottom: 2rem;
        font-size: 0.875rem;
        font-weight: 500;
        flex-wrap: wrap;
      }
      
      .post-meta-divider {
        width: 4px;
        height: 4px;
        background: var(--gray-500);
        border-radius: 50%;
      }
      
      /* Post grid */
      .post-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: var(--space-8);
        margin-bottom: var(--space-12);
      }
      
      /* Card Component */
      .post-card {
        background: white;
        border-radius: 0.75rem;
        overflow: hidden;
        border: 1px solid var(--gray-100);
        transition: all 0.3s var(--ease-out);
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      
      .post-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px -10px rgba(0, 0, 0, 0.1);
        border-color: var(--gray-200);
      }
      
      .post-card-image {
        aspect-ratio: 16/9;
        overflow: hidden;
        background: var(--gray-100);
      }
      
      .post-card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
      }
      
      .post-card:hover .post-card-image img {
        transform: scale(1.05);
      }
      
      .post-card-content {
        padding: 1.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      
      .post-card h2 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        font-weight: 700;
        letter-spacing: -0.025em;
        line-height: 1.4;
      }
      
      .post-card a {
        color: var(--gray-900);
        text-decoration: none;
      }
      
      .post-card a:hover {
        color: var(--primary-600);
      }
      
      .post-excerpt {
        color: var(--gray-600);
        margin: 0.75rem 0;
        font-size: 0.875rem;
        line-height: 1.6;
        flex: 1;
      }
      
      .post-card-meta {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--gray-500);
        font-size: 0.75rem;
        font-weight: 500;
      }
      
      /* Post list fallback */
      .post-list {
        list-style: none;
        padding: 0;
      }
      
      .post-list-item {
        padding: 2rem 0;
        border-bottom: 1px solid var(--gray-100);
      }
      
      .post-list-item:last-child {
        border-bottom: none;
      }
      
      /* Featured image */
      .featured-image {
        margin: 0 -1.5rem 3rem;
        position: relative;
      }
      
      .featured-image img {
        width: 100%;
        height: auto;
        max-height: 600px;
        object-fit: cover;
      }
      
      .featured-image-caption {
        text-align: center;
        margin-top: 1rem;
        font-size: 0.875rem;
        color: var(--gray-500);
        font-style: italic;
      }
      
      @media (min-width: 768px) {
        .featured-image {
          margin: 0 0 3rem;
          border-radius: 0.75rem;
          overflow: hidden;
        }
      }
      
      /* Post navigation */
      .post-navigation {
        margin-top: 4rem;
        padding-top: 3rem;
        border-top: 1px solid var(--gray-100);
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
      }
      
      .post-nav-item {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .post-nav-item.prev {
        text-align: left;
      }
      
      .post-nav-item.next {
        text-align: right;
        align-items: flex-end;
      }
      
      .post-nav-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-500);
        font-weight: 600;
      }
      
      .post-nav-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--gray-900);
        text-decoration: none;
        transition: color 0.2s;
      }
      
      .post-nav-title:hover {
        color: var(--primary-600);
      }
      
      @media (max-width: 640px) {
        .post-navigation {
          grid-template-columns: 1fr;
        }
      }
      
      /* Footer */
      footer {
        margin-top: 5rem;
        padding: 3rem 0;
        border-top: 1px solid var(--gray-100);
        background: var(--gray-50);
      }
      
      .footer-content {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 3rem;
        margin-bottom: 2rem;
      }
      
      .footer-section h3 {
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--gray-900);
        margin-bottom: 1rem;
      }
      
      .footer-section p,
      .footer-section a {
        font-size: 0.875rem;
        color: var(--gray-600);
        text-decoration: none;
        line-height: 1.75;
      }
      
      .footer-section a:hover {
        color: var(--primary-600);
      }
      
      .footer-section ul {
        list-style: none;
        padding: 0;
      }
      
      .footer-section li {
        margin-bottom: 0.5rem;
      }
      
      .footer-bottom {
        text-align: center;
        padding-top: 2rem;
        border-top: 1px solid var(--gray-200);
        color: var(--gray-500);
        font-size: 0.875rem;
      }
      
      @media (max-width: 768px) {
        .footer-content {
          grid-template-columns: 1fr;
          gap: 2rem;
        }
      }
      
      /* Utility classes */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }
      
      /* Loading skeleton */
      .skeleton {
        background: linear-gradient(90deg, var(--gray-100) 25%, var(--gray-200) 50%, var(--gray-100) 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
      }
      
      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }
      
      /* Component utilities */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-2) var(--space-4);
        font-size: var(--text-sm);
        font-weight: 500;
        line-height: var(--leading-tight);
        border-radius: 0.375rem;
        transition: all 0.2s var(--ease-out);
        cursor: pointer;
        border: 1px solid transparent;
        text-decoration: none;
      }
      
      .btn-primary {
        background: var(--primary-600);
        color: white;
      }
      
      .btn-primary:hover {
        background: var(--primary-700);
        transform: translateY(-1px);
      }
      
      .btn:focus {
        outline: 2px solid var(--primary-500);
        outline-offset: 2px;
      }
      
      .badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        font-size: var(--text-xs);
        font-weight: 600;
        line-height: 1rem;
        border-radius: 9999px;
        text-transform: uppercase;
        letter-spacing: var(--tracking-wide);
      }
      
      .badge-primary {
        background: var(--primary-100);
        color: var(--primary-700);
      }
      
      .badge-featured {
        background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
        color: white;
        box-shadow: 0 2px 4px rgba(99, 102, 241, 0.2);
      }
      
      /* Animations */
      @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      @keyframes slide-up {
        from { 
          opacity: 0;
          transform: translateY(1rem);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .animate-fade-in {
        animation: fade-in 0.6s var(--ease-out);
      }
      
      .animate-slide-up {
        animation: slide-up 0.6s var(--ease-out);
      }
      
      /* Responsive utilities */
      @media (max-width: 640px) {
        article h1 { font-size: var(--text-4xl); }
        article h2 { font-size: var(--text-2xl); }
        article h3 { font-size: var(--text-xl); }
        article p { font-size: var(--text-base); }
        .hero h2 { font-size: var(--text-4xl); }
        .hero p { font-size: var(--text-lg); }
        .container { padding: 0 var(--space-4); }
        .container-narrow { padding: 0 var(--space-4); }
        
        /* Ensure minimum font sizes for accessibility */
        body { font-size: 16px; }
        .post-card-meta { font-size: 14px; }
        .footer-section p,
        .footer-section a { font-size: 14px; }
        
        /* Ensure tap targets are at least 44px */
        .btn { min-height: 44px; padding: var(--space-3) var(--space-4); }
        header a { min-height: 44px; display: flex; align-items: center; }
        .post-nav-title { min-height: 44px; display: flex; align-items: center; }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-content">
            <div style="font-size: 1.5rem; font-weight: 700; letter-spacing: -0.025em;"><a href="/" style="color: var(--gray-900); text-decoration: none; transition: color 0.2s;">Bucky Chu | Railquill</a></div>
          <nav class="header-nav">
            <a href="/">Home</a>
            <a href="/about">About</a>
            <a href="/archive">Archive</a>
            <a href="/feed.xml" title="RSS Feed" aria-label="RSS Feed">
              <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
  <path d="M3.75 3a.75.75 0 0 0-.75.75v.5c0 .414.336.75.75.75H4c6.075 0 11 4.925 11 11v.25c0 .414.336.75.75.75h.5a.75.75 0 0 0 .75-.75V16C17 8.82 11.18 3 4 3h-.25Z"></path>
  <path d="M3 8.75A.75.75 0 0 1 3.75 8H4a8 8 0 0 1 8 8v.25a.75.75 0 0 1-.75.75h-.5a.75.75 0 0 1-.75-.75V16a6 6 0 0 0-6-6h-.25A.75.75 0 0 1 3 9.25v-.5ZM7 15a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path>
</svg>

              <span class="sr-only">RSS Feed</span>
            </a>
          </nav>
        </div>
      </div>
    </header>
    
    <main>
      <!-- BEGIN app/views/static/post.html.erb --><div class="container-narrow">
  <article class="animate-fade-in">
    <!-- Article Header -->
    <header style="text-align: center; margin-bottom: var(--space-12); padding-top: var(--space-8);">
      <h1 style="font-size: var(--text-5xl); font-weight: 800; line-height: var(--leading-tight); letter-spacing: var(--tracking-tight); margin-bottom: var(--space-6); color: var(--gray-900); max-width: 800px; margin-left: auto; margin-right: auto;">
        Rust 從零開始網頁爬蟲(2024 Hello World)
      </h1>
      <div class="post-meta" style="justify-content: center; margin-bottom: var(--space-4);">
        <span style="color: var(--gray-600);">September 13, 2024</span>
          <span class="post-meta-divider"></span>
          <span style="color: var(--gray-600);">7 min read</span>
      </div>
        <p style="font-size: var(--text-xl); color: var(--gray-600); line-height: var(--leading-relaxed); font-style: italic; max-width: 600px; margin: 0 auto; font-family: var(--font-serif);">
          本篇文章是 2024 Hello World Dev Conference 工作坊的實作流程，可以搭配 Github repohttps://github.com/bucky0112/scrapingrust 一起使用。

 Rust 簡介
Rust 是一個近年來引起非常多討論的程式語言，因為效能出色，並且安全性...
        </p>
    </header>
    
    <!-- Featured Image -->
    
    <!-- Article Content -->
    <div class="post-content animate-slide-up" style="animation-delay: 0.4s; font-family: var(--font-serif); font-size: var(--text-lg); line-height: var(--leading-loose); color: var(--gray-800);">
      <p>本篇文章是 2024 Hello World Dev Conference 工作坊的實作流程，可以搭配 <a href="https://github.com/bucky0112/scraping_rust">Github repo</a> 一起使用。</p>

<h2 id="rust">Rust 簡介</h2>

<p>Rust 是一個近年來引起非常多討論的程式語言，因為效能出色，並且安全性極佳，寫起來非常有趣，在每一年的 Stackoverflow 調查中已經連續蟬聯多年的最受歡迎程式語言（most-admired programming language），可以參考今年 2024 的<a href="https://survey.stackoverflow.co/2024/technology/#admired-and-desired">調查</a>。也因為討論度很高，並且很多國際知名企業也紛紛投入使用，可以感受到似乎引領了一股風潮，好像什麼都要用 Rust 來改寫原本的產品，或者是出現以 Rust 開發的新東西。</p>

<h2 id="rust">安裝 Rust</h2>

<p>要安裝 Rust 非常簡單，只要進到<a href="https://www.rust-lang.org/zh-TW/">官網</a>，然後按下“立即開始”的按鈕，就會偵測你目前電腦的系統，並給你安裝的建議與說明。像是我的電腦是 macOS 系統，所以只要按照指示，在終端機執行指令，就可以開始安裝。</p>

<p>安裝 Rust 這個步驟主要會安裝兩個東西，分別是：</p>

<ul>
<li>Rustup</li>
<li>Cargo</li>
</ul>

<p>Rustup 是 Rust 的安裝與版本管理工具，而 Cargo 則是 Rust 的建置與套件管理工具。</p>

<p>如果想確認是否安裝成功，可以在終端機下指令：</p>

<pre><code class="bash!">rustc -V
</code></pre>

<p>或者是：</p>

<pre><code class="bash!">cargo -V
</code></pre>

<p>這兩個都能檢查目前安裝的版本（截至目前為止的版本為 1.81.0），例如下圖：</p>

<p><img src="https://i.imgur.com/3tIP2Jq.png" alt="20240913005124"></p>

<h2 id="hello-world">Hello World，建立專案</h2>

<p>既然安裝好了，不免俗的讓我們來做一個 Hello World，這裡會直接使用 Cargo 來建立一個 Rust 專案，請在終端機執行：</p>

<pre><code class="bash!">cargo new demo
</code></pre>

<p>這段指令代表要使用 Cargo 來建立一個名稱 <code>demo</code> 的專案，當然名稱可以自由命名。然後進入到該專案之後，並使用習慣的編輯器打開，例如 VSCode。</p>

<h3 id="vscode">建議 VSCode 套件</h3>

<p>如果是習慣用 VSCode 的人，強烈建議 <a href="https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer">rust-analyzer</a> 這個套件。在開發中可以有一些提示，或者是錯誤的提醒。</p>

<p>現在你應該使用編輯器打開專案了，並且可以看到專案的架構：</p>

<pre><code>.
├── src
│   └── main.rs
├── target
├── .gitignore
├── Cargo.lock
└── Cargo.toml
</code></pre>

<p>整個專案最主要的檔案是在 <code>src</code> 底下的 <code>main.rs</code>，它是 Rust 專案的 entrypoint，任何邏輯都會經由這裡來發動執行，那麼我們來看看 <code>main.rs</code> 這個檔案。</p>

<pre><code class="rust!">fn main() {
    println!("Hello, world!");
}
</code></pre>

<p>可以看到建立專案已經幫我們處理好 Hello World 了，但是這個 <code>println!()</code> 是什麼？</p>

<p>以目的來說，他可以幫我們印出 Hello World，雖然看起來很像是一個函式，但在 Rust 中其實不是函式，而是一個巨集（Marco），可以先大概了解就可以。</p>

<h3 id="part-2c1204f93c6ace21">執行專案</h3>

<p>在 Cargo 專案中，要執行並且運作程式碼，可以在終端機下指令：</p>

<pre><code class="bash!">cargo run
</code></pre>

<p>這一段指令會編譯並且執行目前的程式碼，所以可以在終端機看到 <code>Hello World</code> 的結果。</p>

<h2 id="part-2ea806877f2aa35a">開始爬蟲</h2>

<p>在開始之前，需要先安裝這個專案需要用的套件。</p>

<h3 id="part-8da8f8589c6df2b2">套件的搜尋</h3>

<p>如果是熟悉網頁開發的朋友，大概都會知道有 NPM 這個東西，而 Rust 也有一個類似 NPM 的網站，那就是 <a href="https://crates.io/">crates.io</a></p>

<p><img src="https://i.imgur.com/w0EM3SF.png" alt="20240913005147"></p>

<p>我們需要安裝這些套件：</p>

<ul>
<li><a href="https://crates.io/crates/tokio">tokio</a></li>
<li><a href="https://crates.io/crates/reqwest">reqwest</a></li>
<li><a href="https://crates.io/crates/scraper">scraper</a></li>
</ul>

<p>tokio 主要是處理非同步的操作；reqwest 是處理 HTTP 請求；scraper 則是處理網頁元素的選擇。</p>

<h3 id="part-708b4c5e64bc6729">套件安裝的方式</h3>

<p>套件安裝的方式有分成在終端機下指令安裝，和在專案中的 <code>Cargo.toml</code> 手動輸入。以 tokio 為例，可以在右邊的 <strong>Install</strong> 區塊看到安裝方式。</p>

<p><img src="https://i.imgur.com/jQNPm5Q.png" alt="20240913005454"></p>

<p>第一種方式是在終端機下指令：</p>

<pre><code class="bash!">cargo add tokio
</code></pre>

<p>第二種方式可以打開 <code>Cargo.toml</code> 這個檔案，然後在 <code>[dependencies]</code> 底下輸入：</p>

<pre><code class="toml!">tokio = "1.40.0"
</code></pre>

<h3 id="tokio">安裝 tokio 需要注意的地方</h3>

<p>由於 crates 大都預設是基本的安裝，所以當需要開啟某些功能，還需要開啟設定，安裝的方式可以這樣做：</p>

<p>第一種在終端機下指令：</p>

<pre><code class="bash!">cargo add tokio -F full
</code></pre>

<p>第二種方式也可以透過 <code>Cargo.toml</code> 來安裝：</p>

<pre><code class="toml!">tokio = { version = "1.40.0", features = ["full"] }
</code></pre>

<p>如果是經由 <code>Cargo.toml</code> 來安裝的話，還需要在終端機下指令來進行編譯：</p>

<pre><code class="bash!">cargo build
</code></pre>

<p>目前的 <code>Cargo.toml</code> 應該會是這樣：</p>

<p><img src="https://i.imgur.com/Oi9WD2y.png" alt="20240913005210"></p>

<h2 id="part-cc3a7ae4d4b902ac">要進行爬蟲的資料來源</h2>

<p>這次工作坊要進行的爬蟲練習來源是<a href="https://books.toscrape.com/">這個網站</a>。這是一個專門練習爬蟲的網站。</p>

<p><img src="https://i.imgur.com/9LeonzC.png" alt="20240913005230"></p>

<h2 id="part-84aab2f83254d926">試著取得網頁內容</h2>

<p>接下來就可以寫一些程式碼，先試著連到這個網站並取得網頁內容：</p>

<pre><code class="rust!">use reqwest;       // 使用 reqwest

#[tokio::main]     // 在 main 標記使用 tokio 處理非同步
async fn main() {  // 在 main 前面加上 async
    let url = "https://books.toscrape.com/"; // 連結的 URL
    let response = reqwest::get(url).await.unwrap(); // 使用 get
    let body = response.text().await.unwrap(); // 將 response 轉成可辨識的文字

    println!("{}", body); // 印出 body
}
</code></pre>

<p>然後執行 <code>cargo run</code>，應該會看到印出整個網頁的內容。</p>

<h2 id="html">解析 HTML</h2>

<p>確認網頁內容沒問題之後，就可以進行下一步來解析 HTML，這裡需要借助 scraper。</p>

<pre><code class="rust!">use scraper::Html; // 使用 scraper 的 HTML 方法

// ...

let document = Html::parse_document(&amp;body); // 解析 body

println!("{}", document);
</code></pre>

<p>這時候執行 <code>cargo run</code> 之後，會發現到有錯誤。</p>

<p><img src="https://i.imgur.com/3G01s3z.png" alt="20240913005245"></p>

<p>Cargo 會提供完整的錯誤提示，甚至會跟你說你應該怎麼做比較好，所以就可以按照它的建議在 <code>println!()</code> 中的 <code>{}</code> 改成 <code>{:?}</code> 或者是 <code>{:#?}</code>。</p>

<p>可以改成以下幾種方式：</p>

<pre><code class="rust!">println!("{:?}", document); // debug 格式化

println!("{:#?}", document); // pretty-print 格式

println!("{}", document.html()); // 轉回字符串，就是轉回原來的格式
</code></pre>

<h2 id="part-e84c99d59c7ac262">決定抓取哪些資料</h2>

<p>我們主要是要抓每本書的名稱以及價錢，打開開發者工具檢查 HTML 架構，可以發現這裡是用 <code>&lt;li&gt;</code> 來區分每本書，但我們需要更方便辨識的方法，也就是按照 <code>&lt;li&gt;</code> 中的 <code>&lt;article&gt;</code>，這裡有 class 可以辨識，也就是 <code>product_pod</code>，這樣就可以去選取每一本獨立的書。</p>

<p>當選擇完每本書之後，就要去抓取書的書名以及價錢，可以在 <code>&lt;h3&gt;</code> 和 <code>.product_price</code>。</p>

<p><img src="https://i.imgur.com/9d2KXjp.png" alt="20240913005302"></p>

<h2 id="part-5df8ce0a942e77ae">建立選取器</h2>

<pre><code class="rust!">use scraper::{Html, Selector};
// ...
let book_selector = Selector::parse("article.product_pod").unwrap();
let title_selector = Selector::parse("h3 a").unwrap();
let price_selector = Selector::parse("div.product_price .price_color").unwrap();
</code></pre>

<h2 id="part-da3d97c51885cb4d">使用迴圈撈取資料</h2>

<p>接下來就可以使用迴圈來撈取資料：</p>

<pre><code class="rust!">for book in document.select(&amp;book_selector) {
    let title = book
        .select(&amp;title_selector)
        .next()
        .unwrap()
        .text()
        .collect::&lt;String&gt;();
    let price = book
        .select(&amp;price_selector)
        .next()
        .unwrap()
        .text()
        .collect::&lt;String&gt;();

    println!("書名: {}", title);
    println!("價格: {}", price);
    println!("---");
}
</code></pre>

<p>執行 <code>cargo run</code> 之後，這樣就可以把每本書的書名以及價格全部印出來。</p>

<h2 id="part-f8bb379b2d44a6da">利用屬性取得完整書名</h2>

<p>執行完之後雖然可以取得書名以及價格，但是應該可以發現有些書名並不是完整的書名。</p>

<p><img src="https://i.imgur.com/U09lOci.png" alt="20240913005317"></p>

<p>這是因為網站本身在處理書名時，可能是針對太長的書名有進行修改。沒關係，可以看一下 HTML 架構中是否有提供完整的書名。</p>

<p><img src="https://i.imgur.com/rYQZwJE.png" alt="20240913005328"></p>

<p>我們發現在 <code>&lt;h3&gt;</code> 中的 <code>&lt;a&gt;</code> 有一個 <code>title</code> 的屬性，所以就可以利用這個屬性去取得完整的書名。</p>

<pre><code class="rust!">let title_element = book.select(&amp;title_selector).next().unwrap();
        // 使用 title 屬性獲取完整書名
let title = title_element.value().attr("title").unwrap_or("Unknown Title");
</code></pre>

<p>現在再次執行 <code>cargo run</code> 就可以取得完整的書名了。</p>

<h2 id="part-2e77907a852ede12">錯誤處理</h2>

<p>如果看現在的程式碼，應該可以發現有大量的 <code>unwrap()</code>。其實這個是錯誤處理的方式之一，但是並不能算是非常好的作法，因為當有碰到錯誤的時候，在 <code>unwrap()</code> 這裡就會立即終止所有程式，不會再繼續往下走了，如果是拿來開發初期可能很好用，但是還是要預想遇到錯誤會怎麼繼續往下跑你的程式碼。</p>

<p>這裡就會用到 Rust 本身自帶的工具，從 <code>std</code> 也就是 Rust 的 standard library 中使用 <code>Error</code>：</p>

<pre><code class="rust!">use std::error::Error;
</code></pre>

<p>那麼要怎麼使用呢？</p>

<p>首先會用到 <code>Result</code> 這個 enum，它是一個這樣的結構：</p>

<pre><code class="rust!">pub enum Result&lt;T, E&gt; {
    Ok( /* … */ ),
    Err( /* … */ ),
}
</code></pre>

<p>原本應該也要使用關鍵字 <code>use</code> 來使用：</p>

<pre><code class="rust!">use std::result::Result;
</code></pre>

<p>不過可能因為 <code>Result</code> 是比較常用，所以就不需要特別使用 <code>use</code> 來引入，而是可以直接用。</p>

<pre><code class="rust!">async fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    // ...
    Ok(())
}
</code></pre>

<p>由於 <code>Result</code> 是一個 enum，只有兩條路，不是正確就是錯誤，所以在 <code>main</code> 這裡設置 <code>Result</code> 也就代表了要回傳東西，我們在最後面擺上一個 <code>Ok(())</code> 就好。</p>

<h3 id="unwrap">取代 unwrap()</h3>

<p>接下來其他的錯誤就可以把所有的 <code>unwrap()</code> 都拿掉，但是選取 HTML 的部分如果壞掉，好像也不需要繼續往下執行，所以替換成 <code>?</code> 表示暫不處理。</p>

<pre><code class="rust!">let response = reqwest::get(url).await?;
let body = response.text().await?;
let document = Html::parse_document(&amp;body);

let book_selector = Selector::parse("article.product_pod")?;
let title_selector = Selector::parse("h3 a")?;
let price_selector = Selector::parse("div.product_price .price_color")?;
</code></pre>

<h3 id="part-23705ea99a683cb">可以加上失敗後顯示的文字</h3>

<p>而在迴圈的部分如果找不到相對應的元素就再提示並顯示錯誤訊息。</p>

<pre><code class="rust!">for book in document.select(&amp;book_selector) {
    let title_element = book.select(&amp;title_selector).next().ok_or("找不到 Title 元素")?;
    let title = title_element
        .value()
        .attr("title")
        .ok_or("找不到 Title 屬性")?;
    let price = book
        .select(&amp;price_selector)
        .next()
        .ok_or("找不到 Price 元素")?
        .text()
        .collect::&lt;String&gt;();

        // ...
}
</code></pre>

<h2 id="part-57e3069a57e74102">拿取其他頁面的資料</h2>

<p>由於最下面有分頁，代表其他頁面也有資料還沒撈取，而目前只有爬第一頁的資料，所以我們接下來試著爬完全部頁面的資料。</p>

<p>我們可以先觀察第一頁跟其他頁的差異在哪。</p>

<p>其實整個 HTML 架構都差不多，最大的差別只在於 URL 而已，例如第一頁是 <code>https://books.toscrape.com/</code>，而第二頁則是 <code>https://books.toscrape.com/catalogue/page-2.html</code>，剩下幾頁的差別都只是在 page 之後的數字差別而已，接下來比較方便的作法則是建立一個 client。</p>

<h2 id="client">建立 client 並測試是否可以爬到第二頁</h2>

<p>這一步驟要先使用 <code>reqwest</code> 建立一個 client，比較方便去 get 不同頁面的 URL。下面的程式碼會用迴圈先試跑個兩圈，看看兩頁是不是都能成功連到，然後印出爬到的頁面跟狀態碼是否正確還有符合我們想要的。</p>

<pre><code class="rust!">async fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let client = reqwest::Client::builder().build()?;

    for page in 1..=2 {
        let url = if page == 1 {
            "https://books.toscrape.com".to_string()
        } else {
            format!("https://books.toscrape.com/catalogue/page-{}.html", page)
        };

        println!("正在爬取頁面: {}", url);

        let response = client.get(&amp;url).send().await?;
        println!("狀態: {}", response.status());

        if !response.status().is_success() {
            println!("狀態碼: {}", response.status());
            continue;
        }
    }

    Ok(())
}
</code></pre>

<p>這裡可以試試看把網頁改成錯誤的會發生什麼事，例如把 URL 故意打錯。</p>

<p><img src="https://i.imgur.com/EbXBMgj.png" alt="20240913005349"></p>

<p>到這一步應該都能成功讓兩個頁面的狀態都是 200，所以就可以繼續往下進行。</p>

<h2 id="part-c5d1c9c23b78b396">計算每頁抓到的書是否正確</h2>

<p>如果檢查每一頁應該可以發現每一頁的書都是固定的 20 本，所以檢查一下用選取器在第二頁是否也正常。</p>

<pre><code class="rust!">for page in 1..=2 {
    // 省略
    let body = response.text().await?;
    let document = Html::parse_document(&amp;body);
    let book_selector = Selector::parse("article.product_pod")?;
    // 省略

    let mut book_count = 0;

    for _book in document.select(&amp;book_selector) {
        // 省略
        book_count += 1;
    }

    println!("在第 {} 頁找到 {} 本書", page, book_count);
}
</code></pre>

<p><code>book_count</code> 是一個會一直往上加的值，代表這個值需要一直改變，並且最後會使用這個改變後的變數，所以要使用 <code>mut</code> 這個關鍵字來表示這個變數是可變。</p>

<p>然後 for 迴圈的 <code>book</code> 沒有加上 <code>_</code> 的話，或者應該說在 Rust 的程式碼如果有定義但沒使用，在終端機應該可以看到一些警告，這不是錯誤，只是 Rust 會很 nice 地（雞婆）提醒您有變數沒使用，所以可以註解掉該變數，或者在變數前面加上 <code>_</code>，表示目前暫時用不到。</p>

<p>當然如果你不介意這些警告，也可以不用理他。</p>

<p>執行 <code>cargo run</code> 之後應該會看到兩頁都能撈到 20 本書，所以就可以試著跑完全部的頁面，只要把迴圈的數字改成最大頁數就好，以這個網站來看，改成 50 之後跑看看，觀察一下每一頁狀態是不是正常，找到的書本是不是正確的數字。</p>

<p><img src="https://i.imgur.com/HS1TzKe.png" alt="20240913005408"></p>

<h2 id="part-d2e175ceed2fd712">如果超過頁面會怎麼樣？</h2>

<p>我們知道現在總共有 50 頁，但如果想要看看跑超過 50 頁會怎麼樣，我們來試試看，改成 51。</p>

<p>其實就跟前面故意把 URL 改成錯誤一樣，在第一個迴圈就會出現錯誤，然後按照我們設想的錯誤並回傳錯誤訊息，所以使用正確的錯誤處理是非常好的一件事，這裡如果是用 <code>unwrap()</code> 雖然也可能會回傳錯誤訊息，但這種錯誤是我們可以掌握並處理的。</p>

<h2 id="json">儲存完整資料 -&gt; JSON</h2>

<p>其實現在跑下來是可以在終端機顯示全部並且完整的書名以及價錢，但 50 頁的資料量滿多的，而且也不好閱讀，所以讓我們試著把資料存成 JSON。</p>

<h3 id="crates-json">安裝 crates 來處理 JSON</h3>

<p>我們需要兩種 crates 來處理 JSON，這裡推薦：</p>

<ul>
<li><a href="https://crates.io/crates/serde">serde</a></li>
<li><a href="https://crates.io/crates/serde_json">serde_json</a></li>
</ul>

<p>安裝 serde 需要開啟完整的功能，所以在安裝可以這樣：</p>

<pre><code class="bash!">cargo add serde -F derive
</code></pre>

<p>serde 會按照我們設定的 struct 去解析資料，然後再經由 serde_json 轉出 JSON。</p>

<p><img src="https://i.imgur.com/F33sAl4.png" alt="20240913005422"></p>

<p>struct 是 Rust 中定義型別的一種方式，可以想像成類似 TS 的 interface。</p>

<h3 id="serde-file-struct">使用 serde 以及 File 並定義 struct</h3>

<p>這一步需要使用剛剛安裝的 serde 然後還需要使用 Rust 內建的 File 來轉出檔案，然後還需要定義 JSON 的格式，也就是 struct，然後使用 serde 來標記，最後才能給 serde_json 使用。</p>

<pre><code class="rust!">use serde::{Deserialize, Serialize};
use std::fs::File;

#[derive(Serialize, Deserialize)]
struct Book {
    title: String,
    price: String,
}
</code></pre>

<h3 id="vec">建立一個 Vec</h3>

<p>建立完 JSON 的格式之後，由於 JSON 是由一個陣列包著物件這樣的格式，所以我們還需要建立一個陣列來使用。</p>

<p>不過在 Rust 的世界中，陣列（array）只能是一個固定長度，並且有長度限制，所以除非你確切知道你的資料長度，所以一般動態資料會使用向量 (vector)。</p>

<pre><code class="rust!">let client = reqwest::Client::builder().build()?;
let mut books = Vec::new();
</code></pre>

<h3 id="json">把每本書塞進 JSON</h3>

<p>接下來就可以在 <code>book_selector</code> 迴圈中把每本書都塞進 <code>books</code> 這個 vector 當中。</p>

<pre><code class="rust!"> for book in document.select(&amp;book_selector) {
    book_count += 1;
    let title_element = book.select(&amp;title_selector).next().unwrap();
    let title = title_element
        .value()
        .attr("title")
        .ok_or("找不到 Title 屬性")?;
    let price = book
        .select(&amp;price_selector)
        .next()
        .ok_or("找不到 Price 元素")?
        .text()
        .collect::&lt;String&gt;();

    books.push(Book {
        title: title.to_string(),
        price,
    });

    println!("書名: {}", title);
    // println!("價格: {}", price);
    println!("---");
}
</code></pre>

<p>然後使用 serde_json 和 File 將資料寫成一個 json 檔案。</p>

<pre><code class="rust!">let file = File::create("books.json")?;
serde_json::to_writer_pretty(file, &amp;books)?;

println!("資料已存到 books.json");

Ok(())
</code></pre>

<p>然後你可能會覺得有點奇怪，為什麼將 <code>title</code> 跟 <code>price</code> 塞入的時候，<code>price</code> 並沒有像 <code>title</code> 那樣轉成 string。</p>

<p>這是因為 <code>Book</code> 在 struct 中定義成 String，然後 <code>price</code> 最後有轉成 String，而 <code>title</code> 沒有，它的型別原本是 &amp;str（字串切片）。所以你要在 push 的時候轉成 String 或者是這樣也可以：</p>

<pre><code class="rust!">for book in document.select(&amp;book_selector) {
    book_count += 1;
    let title_element = book.select(&amp;title_selector).next().unwrap();
    let title = title_element
        .value()
        .attr("title")
        .ok_or("找不到 Title 屬性")?
        .to_string();
    let price = book
        .select(&amp;price_selector)
        .next()
        .ok_or("找不到 Price 元素")?
        .text()
        .collect::&lt;String&gt;();

    books.push(Book {
        title,
        price,
    });
}
</code></pre>

<p>然後你就可以執行 <code>cargo run</code> 並且將資料存成 JSON 了。</p>

<h2 id="excel">如果想存成 Excel 可以嗎？</h2>

<p>沒問題！Rust 的 crates 也可以找得到專門處理 excel 的套件，那就是 <a href="https://crates.io/crates/xlsxwriter">xlsxwriter</a>。</p>

<h3 id="xlsxwriter">安裝 xlsxwriter 並使用</h3>

<p>按照說明安裝完之後並使用：</p>

<pre><code class="rust!">use xlsxwriter::Workbook;
</code></pre>

<pre><code class="rust!">let workbook = Workbook::new("books.xlsx")?;
let mut sheet = workbook.add_worksheet(None)?;

sheet.write_string(0, 0, "書名", None)?;
sheet.write_string(0, 1, "價格", None)?;

let mut row = 1;
</code></pre>

<p>變數 <code>row</code> 會按照資料筆數一直增加欄位，所以需要讓他是一個可變變數。
然後在迴圈中寫入：</p>

<pre><code class="rust!">for book in document.select(&amp;book_selector) {
    book_count += 1;
    let title_element = book.select(&amp;title_selector).next().unwrap();
    let title = title_element
        .value()
        .attr("title")
        .ok_or("找不到 Title 屬性")?;
    let price = book
        .select(&amp;price_selector)
        .next()
        .ok_or("找不到 Price 元素")?
        .text()
        .collect::&lt;String&gt;();

    sheet.write_string(row, 0, title, None)?;
    sheet.write_string(row, 1, &amp;price, None)?;

    books.push(Book {
        title: title.to_string(),
        price,
    });

    row += 1;
}
</code></pre>

<p>你可能發現到 sheet 在寫入價格欄位時，<code>price</code> 寫成了 <code>&amp;price</code>。
<code>&amp;</code> 是 Rust 中所有權常用的一個借用概念。</p>

<p>如果拿掉的話，這裡 Cargo 會提示你使用 <code>&amp;</code>，不然會出錯。</p>

<p>執行 <code>cargo run</code> 應該就可以將資料存成 excel。</p>

<h2 id="part-65cea7fea4c33576">自動取得全部頁面資料</h2>

<p>目前已經可以爬完全部頁面的資料，不過如果未來網站資料變多的話，那麼是不是代表會超過 50 頁？
雖然是可以再手動修改頁數，但我們可以去偵測全部的總頁數，然後就可以自動爬完全部頁數的資料了。</p>

<p>我們可以透過一個自定義的 function 來做這件事。</p>

<pre><code class="rust!">async fn get_total_pages(client: &amp;reqwest::Client) -&gt; Result&lt;u32, Box&lt;dyn Error&gt;&gt; {
    let url = "https://books.toscrape.com/index.html";
    let response = client.get(url).send().await?;
    let body = response.text().await?;
    let document = Html::parse_document(&amp;body);

    let pager_selector = Selector::parse("ul.pager li.current")?;
    let pager_text = document
        .select(&amp;pager_selector)
        .next()
        .ok_or("無法找到分頁資料")?
        .text()
        .collect::&lt;String&gt;();

    let total_pages = pager_text
        .split_whitespace()
        .last()
        .ok_or("無法取得總頁數")?
        .parse::&lt;u32&gt;()?;

    Ok(total_pages)
}
</code></pre>

<p>這裡會借用 <code>client</code> 來使用選取器，然後並透過分頁的部分去計算總頁數。</p>

<p><img src="https://i.imgur.com/Izj4Nyn.png" alt="20240913005439"></p>

<p>這裡就可以取代掉原本的數字。</p>

<pre><code class="rust!">    // 取得總頁數
let total_pages = get_total_pages(&amp;client).await?;
println!("總頁數: {}", total_pages);
</code></pre>

<p>執行後，一樣可以正常寫入，但這樣的函式可以幫助我們動態去計算總頁數，然後取得全部的資料。</p>

    </div>
    
    <!-- Share Section -->
    <div class="animate-slide-up" style="animation-delay: 0.6s; margin-top: var(--space-12); padding: var(--space-8) 0; background: linear-gradient(135deg, var(--gray-50) 0%, white 100%); border-radius: 1rem; border: 1px solid var(--gray-100);">
      <div style="text-align: center;">
        <h3 style="font-size: var(--text-lg); font-weight: 600; color: var(--gray-900); margin-bottom: var(--space-2); font-family: var(--font-sans);">Enjoyed this article?</h3>
        <p style="font-size: var(--text-sm); color: var(--gray-600); margin-bottom: var(--space-6); font-family: var(--font-sans);">Share it with your network and help others discover great content</p>
        <div style="display: flex; justify-content: center; gap: var(--space-3); flex-wrap: wrap;">
          <a href="https://twitter.com/intent/tweet?text=Rust+%E5%BE%9E%E9%9B%B6%E9%96%8B%E5%A7%8B%E7%B6%B2%E9%A0%81%E7%88%AC%E8%9F%B2%282024+Hello+World%29&url=https%3A%2F%2Frailquill.vercel.app%2Frust-2024-hello-world.html" 
             target="_blank" 
             rel="noopener" 
             class="btn"
             aria-label="Share this article on Twitter"
             style="background: #1DA1F2; color: white; border-color: #1DA1F2; transition: all 0.2s var(--ease-out);"
             onmouseover="this.style.background='#1a91da'; this.style.transform='translateY(-1px)';" 
             onmouseout="this.style.background='#1DA1F2'; this.style.transform='translateY(0)';">
            <svg style="width: 1rem; height: 1rem; margin-right: var(--space-2);" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
            </svg>
            Share on Twitter
          </a>
          <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Frailquill.vercel.app%2Frust-2024-hello-world.html" 
             target="_blank" 
             rel="noopener" 
             class="btn"
             aria-label="Share this article on LinkedIn"
             style="background: #0077B5; color: white; border-color: #0077B5; transition: all 0.2s var(--ease-out);"
             onmouseover="this.style.background='#005885'; this.style.transform='translateY(-1px)';" 
             onmouseout="this.style.background='#0077B5'; this.style.transform='translateY(0)';">
            <svg style="width: 1rem; height: 1rem; margin-right: var(--space-2);" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
            Share on LinkedIn
          </a>
        </div>
      </div>
    </div>
  </article>
  
  <!-- Post Navigation -->
  <nav class="post-navigation animate-slide-up" style="animation-delay: 0.8s; margin-top: var(--space-16); padding-top: var(--space-12); border-top: 2px solid var(--gray-100);">
      <div class="post-nav-item prev">
        <span class="post-nav-label" style="color: var(--gray-500); font-family: var(--font-sans);">← Previous Post</span>
        <a href="/type-or-interface.html" class="post-nav-title" style="font-family: var(--font-sans);" aria-label="Previous post: Type or Interface?">
          Type or Interface?
        </a>
      </div>
    
      <div class="post-nav-item next">
        <span class="post-nav-label" style="color: var(--gray-500); font-family: var(--font-sans);">Next Post →</span>
        <a href="/flutter.html" class="post-nav-title" style="font-family: var(--font-sans);" aria-label="Next post: 從手把手環境設定到建立第一個 Flutter 專案">
          從手把手環境設定到建立第一個 Flutter 專案
        </a>
      </div>
  </nav>
  
  <!-- Back to Home -->
  <div style="text-align: center; margin-top: var(--space-12); padding-top: var(--space-8); border-top: 1px solid var(--gray-100);">
    <a href="/" class="btn" style="background: var(--gray-100); color: var(--gray-700); border-color: var(--gray-200);" onmouseover="this.style.background='var(--gray-200)'; this.style.transform='translateY(-1px)';" onmouseout="this.style.background='var(--gray-100)'; this.style.transform='translateY(0)';" aria-label="Go back to articles list">
      <div style="width: 1rem; height: 1rem; margin-right: var(--space-2);">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
  <path fill-rule="evenodd" d="M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z" clip-rule="evenodd"></path>
</svg>

      </div>
      Back to Articles
    </a>
  </div>
</div><!-- END app/views/static/post.html.erb -->
    </main>
    
    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>About Bucky Chu | Railquill</h3>
            <p>From web applications to mobile apps and indie games, I love building across different platforms.  
This blog, built...</p>
          </div>
          <div class="footer-section">
            <h3>Quick Links</h3>
            <ul>
              <li><a href="/">Home</a></li>
              <li><a href="/about">About</a></li>
              <li><a href="/archive">Archive</a></li>
              <li><a href="/feed.xml">RSS Feed</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h3>Connect</h3>
            <ul>
              <li><a href="https://x.com/bucky0112" target="_blank" rel="noopener">Twitter</a></li>
              <li><a href="https://github.com/bucky0112/railquill" target="_blank" rel="noopener">GitHub</a></li>
              <li><a href="mailto:bucky0112@gmail.com">Email</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2025 Bucky Chu | Railquill. Built with Rails and love.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
<!-- END app/views/layouts/static.html.erb -->